<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Processor Button Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 10px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>File Processor Button Test</h1>
    
    <div class="test-section">
        <h2>1. Module Loading Test</h2>
        <div id="module-status" class="result info">Testing module loading...</div>
        <div id="module-details"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Configuration Test</h2>
        <div id="config-status" class="result info">Testing configuration...</div>
        <div id="config-details"></div>
    </div>
    
    <div class="test-section">
        <h2>3. File Processor Form Test</h2>
        <form id="test-form">
            <div>
                <label>Input Directory:</label>
                <input type="text" id="input-dir" value="/test/directory" />
            </div>
            <div>
                <label>Output File:</label>
                <input type="text" id="output-file" value="test_output.json" />
            </div>
            <button type="submit" id="submit-btn">Start Processing</button>
        </form>
        <div id="form-status" class="result info">Ready to test form submission...</div>
    </div>
    
    <div class="test-section">
        <h2>4. Event Listener Test</h2>
        <button id="direct-test-btn">Direct Button Test</button>
        <div id="button-status" class="result info">Ready to test button click...</div>
    </div>

    <script type="module">
        // Test 1: Module Loading
        async function testModuleLoading() {
            const statusDiv = document.getElementById('module-status');
            const detailsDiv = document.getElementById('module-details');
            
            try {
                statusDiv.textContent = 'Attempting to import fileProcessor module...';
                
                // Try to import the fileProcessor module
                const fileProcessorModule = await import('/static/js/modules/features/fileProcessor.js');
                
                if (fileProcessorModule.default) {
                    statusDiv.className = 'result success';
                    statusDiv.textContent = '‚úÖ fileProcessor module loaded successfully!';
                    
                    // Check if global instance exists
                    if (window.fileProcessor) {
                        detailsDiv.innerHTML = `
                            <div class="success">‚úÖ Global fileProcessor instance found</div>
                            <div class="info">üìä Module state: ${JSON.stringify(window.fileProcessor.state, null, 2)}</div>
                        `;
                    } else {
                        detailsDiv.innerHTML = `<div class="error">‚ùå Global fileProcessor instance not found</div>`;
                    }
                } else {
                    throw new Error('Module loaded but no default export found');
                }
                
            } catch (error) {
                statusDiv.className = 'result error';
                statusDiv.textContent = `‚ùå Module loading failed: ${error.message}`;
                detailsDiv.innerHTML = `<div class="error">Error details: ${error.stack}</div>`;
            }
        }
        
        // Test 2: Configuration Test
        async function testConfiguration() {
            const statusDiv = document.getElementById('config-status');
            const detailsDiv = document.getElementById('config-details');
            
            try {
                statusDiv.textContent = 'Testing configuration imports...';
                
                // Test endpoints import
                const endpointsModule = await import('/static/js/modules/config/endpoints.js');
                const constantsModule = await import('/static/js/modules/config/constants.js');
                
                statusDiv.className = 'result success';
                statusDiv.textContent = '‚úÖ Configuration modules loaded successfully!';
                
                detailsDiv.innerHTML = `
                    <div class="success">‚úÖ Endpoints module: ${Object.keys(endpointsModule.API_ENDPOINTS || {}).length} endpoint groups</div>
                    <div class="success">‚úÖ Constants module: ${Object.keys(constantsModule.CONSTANTS || {}).length} constants</div>
                    <div class="info">üìä FILE_PROCESSING endpoints: ${JSON.stringify(endpointsModule.API_ENDPOINTS?.FILE_PROCESSING, null, 2)}</div>
                `;
                
            } catch (error) {
                statusDiv.className = 'result error';
                statusDiv.textContent = `‚ùå Configuration test failed: ${error.message}`;
                detailsDiv.innerHTML = `<div class="error">Error details: ${error.stack}</div>`;
            }
        }
        
        // Test 3: Form Submission Test
        function testFormSubmission() {
            const form = document.getElementById('test-form');
            const statusDiv = document.getElementById('form-status');
            
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                console.log('üß™ Form submission intercepted by test handler');
                
                statusDiv.className = 'result success';
                statusDiv.textContent = '‚úÖ Form submission intercepted successfully (no page refresh)!';
                
                // Check if fileProcessor handled it
                if (window.fileProcessor && window.fileProcessor.state.isInitialized) {
                    statusDiv.innerHTML += '<div class="success">‚úÖ fileProcessor is initialized and available</div>';
                } else {
                    statusDiv.innerHTML += '<div class="error">‚ùå fileProcessor not initialized</div>';
                }
            });
            
            statusDiv.textContent = 'Form event listener attached. Click "Start Processing" to test.';
        }
        
        // Test 4: Direct Button Test
        function testDirectButton() {
            const button = document.getElementById('direct-test-btn');
            const statusDiv = document.getElementById('button-status');
            
            button.addEventListener('click', (e) => {
                e.preventDefault();
                console.log('üß™ Direct button clicked');
                
                statusDiv.className = 'result success';
                statusDiv.textContent = '‚úÖ Direct button click handled successfully!';
                
                // Try to call fileProcessor directly
                if (window.fileProcessor && typeof window.fileProcessor.startProcessing === 'function') {
                    statusDiv.innerHTML += '<div class="success">‚úÖ fileProcessor.startProcessing() method is available</div>';
                } else {
                    statusDiv.innerHTML += '<div class="error">‚ùå fileProcessor.startProcessing() method not available</div>';
                }
            });
        }
        
        // Run all tests
        async function runAllTests() {
            console.log('üß™ Starting File Processor tests...');
            
            // Wait a bit for the page to load
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testModuleLoading();
            await testConfiguration();
            testFormSubmission();
            testDirectButton();
            
            console.log('üß™ All tests completed');
        }
        
        // Start tests when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runAllTests);
        } else {
            runAllTests();
        }
    </script>
</body>
</html>