<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test File Processor Button</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
</head>
<body>
    <h1>File Processor Button Test</h1>
    
    <!-- Mimic the structure from the actual HTML -->
    <form id="process-form">
        <input type="text" id="input-dir" value="/test/input" placeholder="Input directory">
        <input type="text" id="output-file" value="test_output" placeholder="Output file">
        <button type="submit" id="submit-btn">Start Processing</button>
    </form>
    
    <div id="progress-container" style="display: none;">
        <div id="progress-bar"></div>
        <div id="progress-status">Status...</div>
        <div id="progress-stats">Stats...</div>
        <button id="cancel-btn">Cancel</button>
    </div>
    
    <div id="result-container" style="display: none;">
        Results will appear here
    </div>
    
    <div id="test-results"></div>
    
    <script type="module">
        console.log('ðŸ§ª Testing File Processor button functionality...');
        
        const resultsDiv = document.getElementById('test-results');
        let testResults = [];
        
        function addResult(test, status, details = '') {
            testResults.push({ test, status, details });
            updateResults();
        }
        
        function updateResults() {
            resultsDiv.innerHTML = testResults.map(r => 
                `<div style="color: ${r.status === 'PASS' ? 'green' : r.status === 'FAIL' ? 'red' : 'orange'}">
                    ${r.status}: ${r.test} ${r.details ? '- ' + r.details : ''}
                </div>`
            ).join('');
        }
        
        try {
            // Test 1: Check if elements exist
            const form = document.getElementById('process-form');
            const button = document.getElementById('submit-btn');
            const inputDir = document.getElementById('input-dir');
            const outputFile = document.getElementById('output-file');
            
            addResult('Form element exists', form ? 'PASS' : 'FAIL');
            addResult('Submit button exists', button ? 'PASS' : 'FAIL');
            addResult('Input directory field exists', inputDir ? 'PASS' : 'FAIL');
            addResult('Output file field exists', outputFile ? 'PASS' : 'FAIL');
            
            // Test 2: Try to import the fileProcessor module
            try {
                const fileProcessorModule = await import('/static/js/modules/features/fileProcessor.js');
                addResult('FileProcessor module import', 'PASS', 'Module loaded successfully');
                
                // Test 3: Check if fileProcessor has the right methods
                const fileProcessor = fileProcessorModule.default;
                addResult('FileProcessor has init method', typeof fileProcessor.init === 'function' ? 'PASS' : 'FAIL');
                addResult('FileProcessor has startProcessing method', typeof fileProcessor.startProcessing === 'function' ? 'PASS' : 'FAIL');
                
                // Test 4: Try to initialize the module
                try {
                    await fileProcessor.init();
                    addResult('FileProcessor initialization', 'PASS', 'Initialized without errors');
                    
                    // Test 5: Check if event listeners are properly attached
                    setTimeout(() => {
                        // Try to click the button programmatically
                        if (button) {
                            const clickEvent = new Event('click');
                            button.dispatchEvent(clickEvent);
                            addResult('Button click simulation', 'PASS', 'Click event dispatched');
                        }
                        
                        // Try form submission
                        if (form) {
                            const submitEvent = new Event('submit', { cancelable: true });
                            const prevented = !form.dispatchEvent(submitEvent);
                            addResult('Form submit simulation', prevented ? 'PASS' : 'WARN', 
                                     prevented ? 'Form submission prevented (expected)' : 'Form submission not prevented');
                        }
                    }, 1000);
                    
                } catch (error) {
                    addResult('FileProcessor initialization', 'FAIL', error.message);
                }
                
            } catch (error) {
                addResult('FileProcessor module import', 'FAIL', error.message);
            }
            
        } catch (error) {
            addResult('Test execution', 'FAIL', error.message);
        }
    </script>
</body>
</html>