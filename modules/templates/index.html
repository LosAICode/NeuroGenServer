<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NeuroGen Processor: File Processor, Playlist Downloader, and Web Scraper with real-time progress tracking">
    <meta name="keywords" content="file processing, data analysis, web scraper, neural generation">
    <meta name="author" content="NeuroGen">
    <meta name="theme-color" content="#0d6efd">
    <title>NeuroGen Processor</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/img/favicon.png">
    
    <!-- Google Fonts - preconnect for better performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    
    <!-- Essential fixes only -->
    <script src="{{ url_for('static', filename='js/fixThemePersistence.js') }}"></script>
    
</head>
<body>
    
    <!-- Header -->
    <header>
        <div class="header-container d-flex align-items-center justify-content-between p-3">
            <h1 class="m-0">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="" height="30" class="me-2">
                NeuroGen
            </h1>
            <div class="d-flex align-items-center">
                <!-- Socket Status Indicator -->
                <div class="socket-status-indicator connecting d-none" id="socket-status">
                    <span class="socket-status-dot"></span>
                    <span class="socket-status-text">Connecting</span>
                </div>
                
                <!-- Help Toggle Button -->
                <button id="helpToggle" class="toggle-btn me-2 bg-transparent border-0 text-white" aria-label="Toggle Help Mode" title="Enable help mode">
                    <i class="fas fa-question-circle fa-lg"></i>
                </button>
                
                <!-- Dark Mode Toggle Button -->
                <button id="darkModeToggle" class="toggle-btn bg-transparent border-0 text-white" aria-label="Toggle Dark Mode" title="Switch between light and dark mode">
                    <i class="fas fa-moon fa-lg"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container my-4" id="main-content">
        <div class="card custom-card shadow-lg">
            <div class="card-body">
                <!-- Nav Tabs -->
                <ul class="nav nav-tabs mb-4" id="processorTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="file-tab" data-bs-toggle="tab" data-bs-target="#file" type="button" role="tab" aria-controls="file" aria-selected="true">
                            <i class="fas fa-file-alt me-1"></i> File Processor
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="playlist-tab" data-bs-toggle="tab" data-bs-target="#playlist" type="button" role="tab" aria-controls="playlist" aria-selected="false">
                            <i class="fas fa-play-circle me-1"></i> Playlist Downloader
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="scraper-tab" data-bs-toggle="tab" data-bs-target="#scraper" type="button" role="tab" aria-controls="scraper" aria-selected="false">
                            <i class="fas fa-globe me-1"></i> Web Scraper
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="false">
                            <i class="fas fa-history me-1"></i> History
                        </button>
                    </li>
                </ul>
                
                <!-- Tab Content -->
                <div class="tab-content" id="processorTabsContent">
                    <!-- ========== FILE PROCESSING TAB ========== -->
                    <div class="tab-pane fade show active" id="file" role="tabpanel" aria-labelledby="file-tab">
                        <!-- Form Container -->
                        <div id="form-container" class="transition-container">
                            <form id="process-form">
                                <!-- Task Status Indicator -->
                                <div class="file-processor-status idle mb-3 d-none" id="processor-status">
                                    <span class="file-processor-status-dot"></span>
                                    <span class="file-processor-status-text">Ready to process files</span>
                                </div>
                                
                                <!-- Enhanced Input Directory Selection with validation feedback -->
                                <div class="mb-4" id="directory-section">
                                    <label for="input-dir" class="form-label">Input Directory</label>
                                    <div class="input-group has-validation">
                                        <input type="text" class="form-control" id="input-dir" name="input_dir" 
                                               placeholder="Enter or select folder path" aria-describedby="directoryHelp">
                                        <button class="btn btn-outline-primary browse-btn" type="button" id="browse-btn" 
                                              title="Browse for a folder on your computer">
                                            <i class="fas fa-folder-open me-1"></i> Browse
                                        </button>
                                        <div class="invalid-feedback">
                                            Please provide a valid input directory.
                                        </div>
                                    </div>
                                    <div id="directoryHelp" class="form-text">
                                        Select the folder containing files to process. Files will be converted to structured JSON.
                                    </div>
                                    <div id="path-info" class="mt-2 d-none">
                                        <div class="alert alert-info py-2 px-3 mb-0 small">
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-info-circle me-2"></i>
                                                <div class="path-info-text">Path information will appear here</div>
                                            </div>
                                        </div>
                                    </div>
                                    <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;" accept="*/*">
                                    <div id="selected-files-info"></div>
                                </div>
                                
                                <!-- Drop Zone for Files -->
                                <div id="drop-zone" class="drop-zone mb-4">
                                    <div class="drop-zone-content text-center">
                                        <i class="fas fa-cloud-upload-alt mb-3" style="font-size: 3rem; color: #ccc;"></i>
                                        <h5>Drag & Drop Files Here</h5>
                                        <p class="text-muted">or click the Browse button above</p>
                                    </div>
                                </div>
                                
                                <!-- Enhanced Output Filename Selection with validation feedback -->
                                <div class="mb-4">
                                    <label for="output-file" class="form-label">Output JSON Filename</label>
                                    <div class="input-group has-validation">
                                        <input type="text" class="form-control" id="output-file" name="output_file" 
                                              placeholder="Your output file name (without extension)" required>
                                        <span class="input-group-text">.json</span>
                                        <div class="invalid-feedback">
                                            Please provide an output filename.
                                        </div>
                                    </div>
                                    <div class="form-text">
                                        Enter just the filename to save in the input directory, or a full path to save elsewhere. 
                                    </div>
                                </div>
                                
                                <!-- Processing Options (Optional, for future expansion) -->
                                <div class="mb-4 d-none" id="processing-options">
                                    <h5 class="mb-3">Processing Options</h5>
                                    <div class="row g-3">
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="option-extract-text" checked>
                                                <label class="form-check-label" for="option-extract-text">
                                                    Extract text content
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="option-extract-tables" checked>
                                                <label class="form-check-label" for="option-extract-tables">
                                                    Extract tables
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="option-parse-structure" checked>
                                                <label class="form-check-label" for="option-parse-structure">
                                                    Parse document structure
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary" id="submit-btn">
                                    <i class="fas fa-play me-2"></i> Start Processing
                                </button>
                            </form>
                        </div>
                        
                        <!-- Progress Container -->
                        <div id="progress-container" class="transition-container d-none">
                            <h4 class="mb-3">Processing Files...</h4>
                            <div class="progress mb-3" style="height: 25px;">
                                <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">0%</div>
                            </div>
                            <div id="progress-status" class="mb-3 text-muted">Initializing...</div>
                            <div id="progress-stats" class="small text-muted mb-3"></div>
                            <button id="cancel-btn" class="btn btn-outline-danger">
                                <i class="fas fa-times me-2"></i> Cancel
                            </button>
                        </div>
                        
                        <!-- Result Container -->
                        <div id="result-container" class="transition-container d-none">
                            <div class="alert alert-success mb-3">
                                <i class="fas fa-check-circle me-2"></i>
                                <span>Processing Completed Successfully!</span>
                            </div>
                            <div id="result-stats" class="mb-3 small"></div>
                            <div class="d-flex gap-2 mb-3">
                                <button id="open-btn" class="btn btn-success open-json-btn">
                                    <i class="fas fa-folder-open me-2"></i> Open JSON
                                </button>
                                <button id="new-task-btn" class="btn btn-outline-primary">
                                    <i class="fas fa-plus me-2"></i> New Task
                                </button>
                            </div>
                        </div>
                        
                        <!-- Error Container -->
                        <div id="error-container" class="transition-container d-none">
                            <div class="alert alert-danger mb-3">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                <span id="error-message">An error occurred during processing.</span>
                            </div>
                            <div id="error-details" class="small text-danger mb-3"></div>
                            <div class="d-none" id="error-stack-container">
                                <pre id="error-stack" class="bg-light p-3 rounded small"></pre>
                            </div>
                            <button id="retry-btn" class="btn btn-outline-primary">
                                <i class="fas fa-redo me-2"></i> Try Again
                            </button>
                        </div>
                        
                        <!-- Cancelled Container -->
                        <div id="cancelled-container" class="transition-container text-center p-4 d-none">
                            <div class="alert alert-warning mb-4">
                                <i class="fas fa-ban me-2"></i> Processing has been cancelled
                            </div>
                            <button id="cancelled-new-task-btn" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i> New Task
                            </button>
                        </div>
                    </div>
                    
                    <!-- ========== PLAYLIST DOWNLOADER TAB ========== -->
                    <div class="tab-pane fade" id="playlist" role="tabpanel" aria-labelledby="playlist-tab">
                        <div id="playlist-form-container" class="transition-container">
                            <form id="playlist-form">
                                <div class="mb-4">
                                    <label class="form-label">YouTube Playlist URLs</label>
                                    <div id="playlist-urls-container">
                                        <div class="input-group mb-2">
                                            <input type="url" class="form-control playlist-url" placeholder="Enter YouTube Playlist URL" required>
                                            <button type="button" class="btn btn-outline-danger remove-url">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="add-playlist-btn">
                                        <i class="fas fa-plus me-1"></i> Add Another Playlist
                                    </button>
                                </div>
                                
                                <!-- Enhanced Playlist Root Directory -->
                                <div class="mb-4">
                                    <label for="playlist-root" class="form-label">Download Root Directory</label>
                                    <div class="input-group has-validation">
                                        <input type="text" class="form-control" id="playlist-root" 
                                              placeholder="Enter full path to root directory" required>
                                        <button class="btn btn-outline-primary browse-btn" type="button" id="playlist-browse-btn" 
                                              title="Browse for a folder on your computer">
                                            <i class="fas fa-folder-open me-1"></i> Browse
                                        </button>
                                        <div class="invalid-feedback">
                                            Please provide a valid directory.
                                        </div>
                                    </div>
                                    <div class="form-text">All playlists will be downloaded into sub-folders under this directory.</div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="playlist-output" class="form-label">Output JSON Filename</label>
                                    <div class="input-group has-validation">
                                        <input type="text" class="form-control" id="playlist-output" placeholder="Output file name (without extension)" required>
                                        <span class="input-group-text">.json</span>
                                        <div class="invalid-feedback">
                                            Please provide an output filename.
                                        </div>
                                    </div>
                                    <div class="form-text">Specify the name for the consolidated JSON output.</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary" id="playlist-submit-btn">
                                    <i class="fas fa-play me-2"></i> Download Playlists
                                </button>
                            </form>
                        </div>
                        
                        <!-- Playlist Progress Container -->
                        <div id="playlist-progress-container" class="transition-container d-none">
                            <h4 class="mb-3">Downloading Playlists...</h4>
                            <div class="progress mb-3" style="height: 25px;">
                                <div id="playlist-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                                     aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">0%</div>
                            </div>
                            <div id="playlist-progress-status" class="mb-3 text-muted">Initializing...</div>
                            <div id="playlist-progress-stats" class="small text-muted mb-3"></div>
                            <button id="playlist-cancel-btn" class="btn btn-outline-danger">
                                <i class="fas fa-times me-2"></i> Cancel
                            </button>
                        </div>
                        
                        <!-- Playlist Result Container -->
                        <div id="playlist-results-container" class="transition-container d-none">
                            <div class="alert alert-success mb-3">
                                <i class="fas fa-check-circle me-2"></i>
                                <span>Playlists Downloaded Successfully!</span>
                            </div>
                            <div id="playlist-stats" class="mb-3 small"></div>
                            <div class="d-flex gap-2">
                                <button id="open-playlist-json" class="btn btn-success open-json-btn">
                                    <i class="fas fa-folder-open me-2"></i> Open JSON
                                </button>
                                <button id="playlist-new-task-btn" class="btn btn-primary">
                                    <i class="fas fa-plus me-2"></i> Download More Playlists
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ========== WEB SCRAPER TAB ========== -->
                    <div class="tab-pane fade" id="scraper" role="tabpanel" aria-labelledby="scraper-tab">
                        <div id="scraper-form-container" class="transition-container">
                            <!-- Academic Search Integration -->
                            <div class="card mb-4 border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h5 class="mb-0">
                                        <i class="fas fa-graduation-cap me-2"></i>Academic Search
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="academic-search-input" class="form-label">Research Topic/Query</label>
                                            <input type="text" class="form-control" id="academic-search-input" placeholder="Enter research topic (e.g., 'machine learning')">
                                        </div>
                                        <div class="col-md-3">
                                            <label for="academic-sources" class="form-label">Academic Source</label>
                                            <select class="form-select" id="academic-sources">
                                                <option value="all">All Sources</option>
                                                <option value="arxiv">arXiv</option>
                                                <option value="semantic">Semantic Scholar</option>
                                                <option value="openalex">OpenAlex</option>
                                            </select>
                                        </div>
                                        <div class="col-md-2">
                                            <label for="pdf-download-count" class="form-label">Max PDFs</label>
                                            <select class="form-select" id="pdf-download-count">
                                                <option value="1">1 PDF</option>
                                                <option value="5">5 PDFs</option>
                                                <option value="10" selected>10 PDFs</option>
                                                <option value="20">20 PDFs</option>
                                                <option value="50">50 PDFs</option>
                                                <option value="100">All PDFs</option>
                                            </select>
                                        </div>
                                        <div class="col-md-1 d-flex align-items-end">
                                            <button type="button" class="btn btn-primary w-100" id="academic-search-btn">
                                                <i class="fas fa-search me-1"></i> Search
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Results area (hidden by default) -->
                                    <div id="academic-results" class="mt-3 d-none">
                                        <h6 class="border-bottom pb-2">Search Results</h6>
                                        <div id="academic-results-container" class="list-group mb-3">
                                            <!-- Results will be populated here -->
                                        </div>
                                        <button id="add-selected-papers" class="btn btn-sm btn-success">
                                            <i class="fas fa-plus-circle me-1"></i> Add Selected Papers
                                        </button>
                                    </div>
                                    
                                    <div class="alert alert-info small mt-3 mb-0">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Search for academic papers across multiple sources. Results can be added to the URL list below with PDF download settings.
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Main Scraper Form -->
                            <form id="scraper-form">
                                <div class="mb-4">
                                    <label class="form-label">Web Scraper URLs</label>
                                    <div id="scraper-urls-container">
                                        <div class="input-group mb-2">
                                            <input type="url" class="form-control scraper-url" placeholder="Enter Website URL" required>
                                            <select class="form-select scraper-settings" style="max-width: 160px;">
                                                <option value="full">Full Text</option>
                                                <option value="metadata">Metadata Only</option>
                                                <option value="title">Title Only</option>
                                                <option value="keyword">Keyword Search</option>
                                                <option value="pdf">PDF Download</option>
                                            </select>
                                            <input type="text" class="form-control scraper-keyword" placeholder="Keyword (optional)" style="display:none;">
                                            <button type="button" class="btn btn-outline-danger remove-url">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="add-scraper-url">
                                        <i class="fas fa-plus me-1"></i> Add Another URL
                                    </button>
                                    <div class="form-text mt-2">
                                        <strong>Options:</strong>
                                        <span class="badge bg-primary">Full Text</span> - Extract all page content
                                        <span class="badge bg-info">Metadata Only</span> - Extract title, description, etc.
                                        <span class="badge bg-success">Title Only</span> - Extract just the page title
                                        <span class="badge bg-warning">Keyword Search</span> - Search for specific keywords
                                        <span class="badge bg-secondary">PDF Download</span> - Download PDFs from academic sites
                                    </div>
                                </div>
                                
                                <!-- Enhanced PDF Info Section -->
                                <div id="pdf-info-section" class="alert alert-info d-none mb-4">
                                    <h5><i class="fas fa-info-circle me-2"></i>PDF Download Mode Selected</h5>
                                    <p>This mode will attempt to download PDFs from the provided URLs. For best results:</p>
                                    <ul>
                                        <li>Use direct links to PDF files when possible (ending with .pdf)</li>
                                        <li>For academic papers, use DOI links (e.g., https://doi.org/10.xxxx/xxxxx)</li>
                                        <li>For arXiv papers, use either abstract or PDF links</li>
                                        <li>The system will try to locate PDFs on pages that don't directly link to PDFs</li>
                                    </ul>
                                    <p><strong>Supported sources:</strong> arXiv, ScienceDirect, Springer, IEEE, ResearchGate, and more.</p>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="process-pdf-switch" checked>
                                        <label class="form-check-label" for="process-pdf-switch">Process PDFs into JSON (may take longer)</label>
                                    </div>
                                </div>
                                
                                <!-- Enhanced Download Directory field -->
                                <div class="mb-4">
                                    <label for="download-directory" class="form-label">Download Directory</label>
                                    <div class="input-group has-validation">
                                        <input type="text" class="form-control" id="download-directory" 
                                              placeholder="Enter download directory for PDFs" required>
                                        <button class="btn btn-outline-primary browse-btn" type="button" id="download-dir-browse-btn" 
                                              title="Browse for a folder on your computer">
                                            <i class="fas fa-folder-open me-1"></i> Browse
                                        </button>
                                        <div class="invalid-feedback">
                                            Please provide a valid directory.
                                        </div>
                                    </div>
                                    <div class="form-text">Specify the directory where PDFs will be downloaded.</div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="scraper-output" class="form-label">Output JSON Filename</label>
                                    <div class="input-group has-validation">
                                        <input type="text" class="form-control" id="scraper-output" placeholder="Output file name" required>
                                        <span class="input-group-text">.json</span>
                                        <div class="invalid-feedback">
                                            Please provide an output filename.
                                        </div>
                                    </div>
                                    <div class="form-text">Structured JSON will be generated with information from all sources.</div>
                                </div>
                                
                                <button type="submit" class="btn btn-primary" id="scrape-btn">
                                    <i class="fas fa-play me-2"></i> Start Scraping
                                </button>
                            </form>
                        </div>
                        
                        <!-- Scraper Progress Container -->
                        <div id="scraper-progress-container" class="transition-container d-none">
                            <h4 class="mb-3">Processing Web Content...</h4>
                            <div class="progress mb-3" style="height: 25px;">
                                <div id="scraper-progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" 
                                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">0%</div>
                            </div>
                            <div id="scraper-progress-status" class="mb-3 text-muted">Initializing...</div>
                            <div id="scraper-progress-stats" class="small text-muted mb-3"></div>
                            
                            <!-- PDF Download Progress Section -->
                            <div id="pdf-download-progress" class="card mb-3 d-none">
                                <div class="card-header">
                                    <h5 class="mb-0">PDF Downloads</h5>
                                </div>
                                <div class="card-body p-0">
                                    <ul id="pdf-downloads-list" class="list-group list-group-flush">
                                        <!-- PDF download items will be added here dynamically -->
                                    </ul>
                                </div>
                            </div>
                            
                            <button id="scraper-cancel-btn" class="btn btn-outline-danger">
                                <i class="fas fa-times me-2"></i> Cancel
                            </button>
                        </div>
                        
                        <!-- Scraper Results Container -->
                        <div id="scraper-results-container" class="transition-container d-none">
                            <div class="alert alert-success mb-3">
                                <i class="fas fa-check-circle me-2"></i>
                                <span>Web Scraping Completed Successfully!</span>
                            </div>
                            <div id="scraper-stats" class="mb-3 small"></div>
                            <pre id="scraper-results" class="d-none"></pre>
                            <div class="d-flex gap-2 mb-3">
                                <button id="open-scraper-json" class="btn btn-success open-json-btn">
                                    <i class="fas fa-folder-open me-2"></i> Open JSON
                                </button>
                                <button id="open-output-folder" class="btn btn-primary">
                                    <i class="fas fa-folder me-2"></i> Open Output Folder
                                </button>
                                <button id="scraper-new-task-btn" class="btn btn-outline-primary">
                                    <i class="fas fa-plus me-2"></i> New Scrape
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ========== HISTORY TAB ========== -->
                    <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                        <div class="mb-4">
                            <div class="d-flex align-items-center justify-content-between">
                                <h5 class="mb-0"><i class="fas fa-history me-2"></i>Task History</h5>
                                <div class="d-flex">
                                    <button id="history-refresh-btn" class="btn btn-sm btn-outline-primary me-2">
                                        <i class="fas fa-sync-alt me-1"></i> Refresh
                                    </button>
                                    <button id="history-clear-btn" class="btn btn-sm btn-outline-danger">
                                        <i class="fas fa-trash me-1"></i> Clear History
                                    </button>
                                </div>
                            </div>
                            <div class="alert alert-info mt-3 small">
                                <i class="fas fa-info-circle me-2"></i>
                                Your task history is stored locally in your browser. It shows up to 50 recent processing tasks.
                            </div>
                        </div>
                        
                        <!-- History Filters and Search -->
                        <div class="row mb-3">
                            <div class="col-md-4 mb-2 mb-md-0">
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-search"></i></span>
                                    <input type="text" id="history-search" class="form-control" placeholder="Search history...">
                                </div>
                            </div>
                            <div class="col-md-4 mb-2 mb-md-0">
                                <select id="history-filter" class="form-select">
                                    <option value="all">All Types</option>
                                    <option value="file">File Processor</option>
                                    <option value="playlist">Playlist</option>
                                    <option value="scraper">Web Scraper</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select id="history-sort" class="form-select">
                                    <option value="newest">Newest First</option>
                                    <option value="oldest">Oldest First</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- History Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Type</th>
                                        <th>File</th>
                                        <th>Date</th>
                                        <th>Stats</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body">
                                    <!-- Task history will be loaded here dynamically -->
                                    <tr class="history-empty-row">
                                        <td colspan="5" class="text-center py-4">
                                            <i class="fas fa-info-circle me-2"></i>No tasks in history
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- PDF Summary Cards -->
                        <div class="mt-4">
                            <h5 class="mb-3">Recent PDF Summaries</h5>
                            <div class="row" id="pdf-summaries-container">
                                <!-- PDF summary cards will be added here dynamically -->
                                <div class="col-12 text-center py-4 text-muted">
                                    <i class="fas fa-file-pdf me-2"></i>No PDF summaries available
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="container text-center my-4">
        <p class="text-muted">&copy; 2025 NeuroGen. All rights reserved.</p>
        <div>
            <button type="button" class="btn btn-sm btn-link text-muted" data-bs-toggle="modal" data-bs-target="#keyboard-shortcuts-modal">
                <i class="fas fa-keyboard me-1"></i> Keyboard Shortcuts
            </button>
            <span class="mx-2">|</span>
            <button type="button" class="btn btn-sm btn-link text-muted" id="about-btn" data-bs-toggle="modal" data-bs-target="#about-modal">
                <i class="fas fa-info-circle me-1"></i> About
            </button>
        </div>
    </footer>
    
    <!-- ========== MODALS ========== -->
    
    <!-- PDF Viewer Modal -->
    <div class="modal fade" id="pdfViewerModal" tabindex="-1" aria-labelledby="pdfViewerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfViewerModalLabel">PDF Viewer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div id="pdf-viewer-container" style="height: 80vh; overflow: auto;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="download-pdf-btn">
                        <i class="fas fa-download me-1"></i> Download PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Task Details Modal -->
    <div class="modal fade" id="task-details-modal" tabindex="-1" aria-labelledby="taskDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskDetailsModalLabel">Task Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="task-details-content">
                    <!-- Task details will be populated here dynamically -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="open-task-file-btn">
                        <i class="fas fa-folder-open me-1"></i> Open File
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Enhanced Path Information Modal -->
    <div class="modal fade" id="path-info-modal" tabindex="-1" aria-labelledby="pathInfoModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pathInfoModalLabel">Directory Information</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="path-info-details">
                    <!-- Path details will be populated here -->
                    <div class="d-flex justify-content-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="create-missing-dir-btn">Create Directory</button>
                    <button type="button" class="btn btn-success" id="use-dir-btn">Use This Directory</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Keyboard shortcuts help modal -->
    <div class="modal fade" id="keyboard-shortcuts-modal" tabindex="-1" aria-labelledby="keyboardShortcutsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="keyboardShortcutsModalLabel">Keyboard Shortcuts</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Shortcut</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><kbd>Ctrl</kbd> + <kbd>1</kbd></td>
                                <td>Switch to File Processor tab</td>
                            </tr>
                            <tr>
                                <td><kbd>Ctrl</kbd> + <kbd>2</kbd></td>
                                <td>Switch to Playlist Downloader tab</td>
                            </tr>
                            <tr>
                                <td><kbd>Ctrl</kbd> + <kbd>3</kbd></td>
                                <td>Switch to Web Scraper tab</td>
                            </tr>
                            <tr>
                                <td><kbd>Ctrl</kbd> + <kbd>4</kbd></td>
                                <td>Switch to History tab</td>
                            </tr>
                            <tr>
                                <td><kbd>Ctrl</kbd> + <kbd>O</kbd></td>
                                <td>Open JSON file (when available)</td>
                            </tr>
                            <tr>
                                <td><kbd>Ctrl</kbd> + <kbd>N</kbd></td>
                                <td>Start new task (when available)</td>
                            </tr>
                            <tr>
                                <td><kbd>Ctrl</kbd> + <kbd>H</kbd></td>
                                <td>Show this help dialog</td>
                            </tr>
                            <tr>
                                <td><kbd>Esc</kbd></td>
                                <td>Close dialogs</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- About Modal -->
    <div class="modal fade" id="about-modal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="aboutModalLabel">About NeuroGen Processor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <img src="{{ url_for('static', filename='img/logo.png') }}" alt="NeuroGen Logo" height="80" class="mb-3">
                        <h4>NeuroGen Processor</h4>
                        <p class="text-muted">Version 1.0.0</p>
                    </div>
                    
                    <p>NeuroGen Processor is an advanced file processing and data extraction tool that helps you organize, analyze, and transform various types of data.</p>
                    
                    <h6>Key Features:</h6>
                    <ul>
                        <li>Process files and folders into structured JSON</li>
                        <li>Download and organize YouTube playlists</li>
                        <li>Scrape web content and download academic PDFs</li>
                        <li>Track processing history and analyze results</li>
                    </ul>
                    
                    <div class="alert alert-info mt-3 small">
                        <i class="fas fa-info-circle me-2"></i>
                        This software is for educational and research purposes only. Please respect copyright and terms of service when downloading content.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast container for notifications -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"></div>
    
    <!-- PDF Summary Card Template -->
    <template id="pdf-summary-card-template">
        <div class="col-md-6 col-lg-4 mb-3 pdf-summary-card">
            <div class="card h-100 shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="mb-0 text-truncate pdf-title">PDF Title</h6>
                    <span class="badge pdf-type-badge">Type</span>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-3">
                        <div class="text-center">
                            <div class="fs-5 pages-count">0</div>
                            <div class="small text-muted">Pages</div>
                        </div>
                        <div class="text-center">
                            <div class="fs-5 tables-count">0</div>
                            <div class="small text-muted">Tables</div>
                        </div>
                        <div class="text-center">
                            <div class="fs-5 file-size">0</div>
                            <div class="small text-muted">MB</div>
                        </div>
                    </div>
                    <p class="pdf-summary small text-muted mb-0">PDF summary will appear here...</p>
                </div>
                <div class="card-footer d-flex gap-2">
                    <button class="btn btn-sm btn-outline-primary flex-grow-1 view-pdf-btn">
                        <i class="fas fa-eye me-1"></i> View
                    </button>
                    <button class="btn btn-sm btn-outline-info flex-grow-1 structure-pdf-btn">
                        <i class="fas fa-sitemap me-1"></i> Structure
                    </button>
                    <button class="btn btn-sm btn-outline-secondary view-json-btn">
                        <i class="fas fa-code"></i>
                    </button>
                </div>
            </div>
        </div>
    </template>
    
    <!-- Scripts -->
    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Console Diagnostics Tool -->
    <script src="{{ url_for('static', filename='js/console-diagnostics.js') }}"></script>
    
    <!-- PDF.js (for PDF viewing) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script>
        // Set PDF.js worker path
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
        }
    </script>
    
    <!-- Keyboard shortcuts are now handled by keyboardShortcuts.js module -->
    
    <!-- Enhanced Module Loader -->
    <script type="module">
        // Track initialization stages
        window.__moduleLoadStart = performance.now();
        window.__loadingStages = {
            scriptLoaded: false,
            modulesImported: false,
            appInitialized: false,
            errors: []
        };
        
        // Create loading indicator
        const loadingIndicator = document.createElement('div');
        loadingIndicator.id = 'module-loading-indicator';
        loadingIndicator.className = 'position-fixed top-0 start-0 w-100';
        loadingIndicator.style.cssText = 'height: 3px; background: linear-gradient(90deg, #007bff 0%, #0056b3 50%, #007bff 100%); background-size: 200% 100%; animation: loading 1.5s ease-in-out infinite; z-index: 9999;';
        loadingIndicator.innerHTML = '<style>@keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }</style>';
        document.body.appendChild(loadingIndicator);
        
        // Enhanced error handling
        window.addEventListener('error', (event) => {
            window.__loadingStages.errors.push({
                message: event.message,
                filename: event.filename,
                line: event.lineno,
                column: event.colno,
                timestamp: new Date().toISOString()
            });
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            window.__loadingStages.errors.push({
                message: event.reason?.message || event.reason,
                type: 'promise_rejection',
                timestamp: new Date().toISOString()
            });
        });
        
        try {
            console.log("🚀 Initializing NeuroGen module system...");
            
            // Import with proper error handling
            const moduleUrl = "{{ url_for('static', filename='js/index-simple.js') }}";
            const module = await import(moduleUrl);
            
            window.__loadingStages.modulesImported = true;
            console.log("✅ Modules imported successfully");
            
            // Wait for app initialization with progressive timeout
            const checkInitialization = async () => {
                const maxAttempts = 30; // 30 seconds total
                let attempts = 0;
                
                while (attempts < maxAttempts) {
                    if (window.appInitialized || window.__appReady) {
                        window.__loadingStages.appInitialized = true;
                        const loadTime = performance.now() - window.__moduleLoadStart;
                        console.log(`✅ Application initialized in ${loadTime.toFixed(0)}ms`);
                        
                        // Remove loading indicator with fade
                        loadingIndicator.style.transition = 'opacity 0.3s';
                        loadingIndicator.style.opacity = '0';
                        setTimeout(() => loadingIndicator.remove(), 300);
                        
                        // Dispatch custom event
                        window.dispatchEvent(new CustomEvent('appReady', {
                            detail: { loadTime, stages: window.__loadingStages }
                        }));
                        
                        return true;
                    }
                    
                    // Progressive delay: faster checks initially, slower later
                    const delay = attempts < 5 ? 200 : attempts < 10 ? 500 : 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    attempts++;
                }
                
                return false;
            };
            
            const initialized = await checkInitialization();
            
            if (!initialized) {
                throw new Error('Application failed to initialize within timeout period');
            }
            
        } catch (error) {
            console.error("❌ Module loading failed:", error);
            window.__loadingStages.errors.push({
                message: error.message,
                stack: error.stack,
                type: 'module_load_error',
                timestamp: new Date().toISOString()
            });
            
            // Enhanced error display
            loadingIndicator.remove();
            
            const errorContainer = document.createElement('div');
            errorContainer.id = 'app-loading-error';
            errorContainer.className = 'alert alert-danger m-3 shadow-lg';
            errorContainer.innerHTML = `
                <div class="d-flex align-items-start">
                    <i class="fas fa-exclamation-triangle fa-2x me-3 text-danger"></i>
                    <div class="flex-grow-1">
                        <h4 class="alert-heading">Application Loading Error</h4>
                        <p class="mb-2">The application failed to load properly. Error details:</p>
                        <div class="bg-dark text-light p-2 rounded mb-3" style="font-family: monospace; font-size: 0.9em;">
                            ${error.message}
                        </div>
                        
                        <details class="mb-3">
                            <summary class="cursor-pointer">Technical Details</summary>
                            <pre class="mt-2 p-2 bg-light rounded" style="font-size: 0.8em; max-height: 200px; overflow-y: auto;">
Loading Stages: ${JSON.stringify(window.__loadingStages, null, 2)}

Error Stack:
${error.stack || 'No stack trace available'}
                            </pre>
                        </details>
                        
                        <div class="d-flex gap-2">
                            <button class="btn btn-primary" onclick="location.reload()">
                                <i class="fas fa-redo me-1"></i> Reload Page
                            </button>
                            <button class="btn btn-outline-secondary" onclick="this.closest('.alert').remove()">
                                <i class="fas fa-times me-1"></i> Dismiss
                            </button>
                            <button class="btn btn-outline-info" onclick="window.__showModuleDiagnostics?.()">
                                <i class="fas fa-stethoscope me-1"></i> Run Diagnostics
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertBefore(errorContainer, document.body.firstChild);
            
            // Try to run diagnostics if available
            if (window.moduleInstances?.moduleDiagnostics) {
                console.log("📊 Running module diagnostics...");
                window.moduleInstances.moduleDiagnostics.logReport();
            }
        }
    </script>
    
    <!-- Fallback for older browsers that don't support ES modules -->
    <script nomodule>
        console.warn("Browser doesn't support ES modules, loading fallback script...");
        
        // Create a script element for the fallback script
        const script = document.createElement('script');
        script.src = "{{ url_for('static', filename='js/main.js') }}";
        script.onerror = (error) => {
            console.error("Error loading fallback script:", error);
            const errorContainer = document.getElementById('app-loading-error') || 
                document.createElement('div');
            
            if (!document.getElementById('app-loading-error')) {
                errorContainer.id = 'app-loading-error';
                errorContainer.className = 'alert alert-danger m-3';
                document.body.appendChild(errorContainer);
            }
            
            errorContainer.innerHTML = `
                <h4>Application Loading Failed</h4>
                <p>Failed to load the application script.</p>
                <p>Please try refreshing the page or using a different browser.</p>
                <button class="btn btn-sm btn-primary mt-2" onclick="location.reload()">Refresh Page</button>
            `;
            errorContainer.style.display = 'block';
        };
        
        // Add the script to the document
        document.head.appendChild(script);
    </script>
    
    <!-- Enhanced Direct Theme Management -->
    <script>
        // Apply stored theme on page load
        (function() {
            const storedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', storedTheme);
            document.body.setAttribute('data-theme', storedTheme);
            
            // Also set up a backup theme toggle in case module system fails
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) {
                const isDark = storedTheme === 'dark';
                const iconElement = darkModeToggle.querySelector('i');
                
                if (iconElement) {
                    iconElement.className = isDark ? 'fas fa-sun fa-lg' : 'fas fa-moon fa-lg';
                } else {
                    darkModeToggle.innerHTML = isDark ? 
                        '<i class="fas fa-sun fa-lg"></i>' : 
                        '<i class="fas fa-moon fa-lg"></i>';
                }
                
                // Add direct event listener as fallback (only if modules not loaded)
                darkModeToggle.addEventListener('click', function() {
                    // Skip if module system is handling themes
                    if (window.appInitialized || (window.moduleInstances && window.moduleInstances.themeManager)) {
                        return;
                    }
                    const currentTheme = document.body.getAttribute('data-theme') || 'dark';
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    // Apply the new theme
                    document.body.setAttribute('data-theme', newTheme);
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    
                    // Update the icon
                    const iconElement = this.querySelector('i');
                    if (iconElement) {
                        iconElement.className = newTheme === 'dark' ? 'fas fa-sun fa-lg' : 'fas fa-moon fa-lg';
                    } else {
                        this.innerHTML = newTheme === 'dark' ? 
                            '<i class="fas fa-sun fa-lg"></i>' : 
                            '<i class="fas fa-moon fa-lg"></i>';
                    }
                    
                    // Try to notify the theme manager module if it's loaded
                    try {
                        if (window.moduleInstances && window.moduleInstances.themeManager) {
                            window.moduleInstances.themeManager.setTheme(newTheme);
                        }
                    } catch (e) {
                        console.log("Could not notify themeManager module of theme change:", e);
                    }
                });
            }
        })();
    </script>
    
<!-- Basic tab navigation fallback -->
<script>
    // Set up basic tab navigation as a fallback when modules fail to load
    document.addEventListener('click', function(event) {
        // Only activate if modules aren't initialized AND check if it's been enough time
        if (window.appInitialized || (window.moduleInstances && Object.keys(window.moduleInstances).length > 0)) return;
        
        // Handle tab navigation
        if (event.target.hasAttribute('data-bs-toggle') && event.target.getAttribute('data-bs-toggle') === 'tab') {
            const tabEl = event.target.closest('[data-bs-toggle="tab"]');
            if (!tabEl) return;
            
            const target = tabEl.getAttribute('data-bs-target') || tabEl.getAttribute('href');
            if (!target) return;
            
            // Remove active class from all tabs and panes
            document.querySelectorAll('.nav-link').forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
            });
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
                pane.classList.remove('show');
            });
            
            // Add active class to clicked tab
            tabEl.classList.add('active');
            tabEl.setAttribute('aria-selected', 'true');
            
            // Show target pane
            const targetPane = document.querySelector(target);
            if (targetPane) {
                targetPane.classList.add('active');
                targetPane.classList.add('show');
            }
            
            event.preventDefault();
        }
    });
    
    // Modal control fallback
    document.addEventListener('click', function(event) {
        // Only activate if modules aren't initialized AND no module instances
        if (window.appInitialized || (window.moduleInstances && Object.keys(window.moduleInstances).length > 0)) return;
        
        // Handle modal toggling
        if (event.target.hasAttribute('data-bs-toggle') && event.target.getAttribute('data-bs-toggle') === 'modal') {
            const modalId = event.target.getAttribute('data-bs-target');
            if (!modalId) return;
            
            const modalEl = document.querySelector(modalId);
            if (!modalEl) return;
            
            // Create bootstrap modal if not already created
            const bsModal = bootstrap.Modal.getInstance(modalEl) || new bootstrap.Modal(modalEl);
            bsModal.show();
        }
    });
    
    // Basic file browsing fallback
    document.querySelectorAll('.browse-btn').forEach(button => {
        button.addEventListener('click', function() {
            // Find the associated file input
            const inputId = this.getAttribute('data-input-target') || 
                            (this.id === 'playlist-browse-btn' ? 'playlist-root' : 
                            (this.id === 'download-dir-browse-btn' ? 'download-directory' : 'input-dir'));
            const fileInput = document.getElementById('folder-input');
            const targetInput = document.getElementById(inputId);
            
            if (fileInput) {
                fileInput.onchange = function() {
                    if (this.files && this.files.length > 0) {
                        // Try to extract folder path from file paths
                        const path = this.files[0].webkitRelativePath || this.files[0].name;
                        const folderPath = path.split('/')[0];
                        
                        if (targetInput && folderPath) {
                            targetInput.value = folderPath;
                        }
                    }
                };
                fileInput.click();
            }
        });
    });
</script>

<!-- Page initialization and error recovery -->
<script>
    // System health monitoring is now handled by systemHealth.js module
    
    // Socket.io connection status indicator
    function setupSocketIndicator() {
        const socketStatus = document.getElementById('socket-status');
        
        if (!socketStatus) return;
        
        // Only setup socket if modules aren't handling it
        if (window.appInitialized || (window.moduleInstances && window.moduleInstances.socketHandler)) {
            return; // Let module system handle socket
        }
        
        // Setup initial state
        socketStatus.classList.remove('d-none');
        
        // Try to connect to socket.io
        // DISABLED: Socket connection is handled by socketHandler module
        /*
        try {
            if (typeof io !== 'undefined' && !window.socket) {
                const socket = io();
                
                socket.on('connect', () => {
                    socketStatus.classList.remove('connecting', 'disconnected');
                    socketStatus.classList.add('connected');
                    socketStatus.querySelector('.socket-status-text').textContent = 'Connected';
                });
                
                socket.on('disconnect', () => {
                    socketStatus.classList.remove('connected', 'connecting');
                    socketStatus.classList.add('disconnected');
                    socketStatus.querySelector('.socket-status-text').textContent = 'Disconnected';
                });
                
                socket.on('connect_error', () => {
                    socketStatus.classList.remove('connected');
                    socketStatus.classList.add('disconnected');
                    socketStatus.querySelector('.socket-status-text').textContent = 'Connection Error';
                });
                
                socket.on('reconnecting', () => {
                    socketStatus.classList.remove('connected', 'disconnected');
                    socketStatus.classList.add('connecting');
                    socketStatus.querySelector('.socket-status-text').textContent = 'Reconnecting...';
                });
                
                // Store socket in window for module access
                window.socket = socket;
            }
        } catch (e) {
            console.error('Socket.io initialization error:', e);
            socketStatus.classList.remove('connecting', 'connected');
            socketStatus.classList.add('disconnected');
            socketStatus.querySelector('.socket-status-text').textContent = 'Unavailable';
        }
        */
    }
    
    // Simple toast notification system as fallback
    function setupFallbackToasts() {
        // Only create fallback toast if no module toast system exists
        if (!window.showToast) {
            window.showToast = function(title, message, type = 'info', duration = 5000) {
            // Check if toastContainer exists, create if not
            let toastContainer = document.getElementById('toast-container');
            if (!toastContainer) {
                toastContainer = document.createElement('div');
                toastContainer.id = 'toast-container';
                toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                document.body.appendChild(toastContainer);
            }
            
            // Generate a unique ID for this toast
            const toastId = 'toast-' + Date.now();
            
            // Set icon and color based on type
            let icon, bgClass;
            switch (type) {
                case 'success':
                    icon = 'fa-check-circle';
                    bgClass = 'bg-success';
                    break;
                case 'error':
                    icon = 'fa-exclamation-circle';
                    bgClass = 'bg-danger';
                    break;
                case 'warning':
                    icon = 'fa-exclamation-triangle';
                    bgClass = 'bg-warning';
                    break;
                default:
                    icon = 'fa-info-circle';
                    bgClass = 'bg-info';
            }
            
            // Create toast HTML
            const toastHtml = `
                <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="toast-header ${bgClass} text-white">
                        <i class="fas ${icon} me-2"></i>
                        <strong class="me-auto">${title}</strong>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                    <div class="toast-body">
                        ${message}
                    </div>
                </div>
            `;
            
            // Add toast to container
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            // Initialize and show the toast using Bootstrap
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, {
                animation: true,
                autohide: true,
                delay: duration
            });
            toast.show();
            
            // Remove toast from DOM after it's hidden
            toastElement.addEventListener('hidden.bs.toast', () => {
                toastElement.remove();
            });
        };
        }
    }
    
    // Initialize minimal fallback systems
    document.addEventListener('DOMContentLoaded', function() {
        // Only setup socket indicator and toasts as fallbacks
        setupSocketIndicator();
        setupFallbackToasts();
        
        // Other functionality is handled by modules:
        // - System health: systemHealth.js
        // - Drag and drop: dragDropHandler.js
        // - Keyboard shortcuts: keyboardShortcuts.js
    });
</script>

<!-- Add a hidden error container that we can use to show problems -->
<div id="app-loading-error" class="alert alert-danger m-3" style="display: none;"></div>

</body>
</html>